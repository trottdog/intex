<!-- views/myJourney/account.ejs -->
<%
  const participant = typeof currentParticipant !== 'undefined' ? currentParticipant : {};
  const user = typeof currentUser !== 'undefined' ? currentUser : {};
 
  
  // Profile data
  const firstName = participant.participant_first_name || '';
  const lastName = participant.participant_last_name || '';
  const email = participant.participant_email || user.email || '';
  const phone = participant.participant_phone || '';
  const school = participant.participant_school || '';
  const grade = participant.participant_grade || '';
  const birthdate = participant.participant_birthdate || '';
  const profilePhoto = participant.profile_photo_path || null;
  const coverPhoto = participant.cover_photo_path || null;
  
  // Initials for fallback
  const initials = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase() || '?';
%>

<!-- Profile Cover & Header (Facebook-style) -->
<div class="profile-header">
  <div class="profile-cover" id="coverPhotoContainer">
    <% if (coverPhoto) { %>
      <img src="<%= coverPhoto %>" alt="Cover photo" class="cover-image" />
    <% } else { %>
      <div class="cover-placeholder"></div>
    <% } %>
    <button class="cover-edit-btn" onclick="openCoverUpload()" title="Change cover photo">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
        <circle cx="12" cy="13" r="4"></circle>
      </svg>
      Edit Cover
    </button>
  </div>
  
  <div class="profile-header-content">
    <div class="profile-avatar-container">
      <div class="profile-avatar" id="profilePhotoContainer">
        <% if (profilePhoto) { %>
          <img src="<%= profilePhoto %>" alt="Profile photo" />
        <% } else { %>
          <span class="initials"><%= initials %></span>
        <% } %>
      </div>
      <button class="avatar-edit-btn" onclick="openPhotoUpload()" title="Change profile photo">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
          <circle cx="12" cy="13" r="4"></circle>
        </svg>
      </button>
    </div>
    
    <div class="profile-header-info">
      <h1 class="profile-name"><%= firstName %> <%= lastName %></h1>
      <p class="profile-email"><%= email %></p>
      <div class="profile-badges">
        <% if (participant.programs_enrolled && participant.programs_enrolled.length > 0) { %>
          <% participant.programs_enrolled.forEach(program => { %>
            <span class="badge badge--accent"><%= program %></span>
          <% }) %>
        <% } %>
      </div>
    </div>
    
    <div class="profile-header-actions">
      <a href="/my-journey" class="btn btn-outline btn-sm">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        Dashboard
      </a>
    </div>
  </div>
</div>

<!-- Profile Tabs -->
<div class="profile-tabs">
  <button class="profile-tab profile-tab--active" data-tab="info">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
      <circle cx="12" cy="7" r="4"></circle>
    </svg>
    Profile Info
  </button>
  <button class="profile-tab" data-tab="security">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
    </svg>
    Security
  </button>
  <button class="profile-tab" data-tab="preferences">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="3"></circle>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
    </svg>
    Preferences
  </button>
</div>

<!-- Tab Content -->
<div class="profile-content">
  <!-- Profile Info Tab -->
  <div class="tab-panel tab-panel--active" id="tab-info">
    <form action="/my-journey/account" method="POST" class="profile-form">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <input type="hidden" name="action" value="update_profile" />
      
      <div class="form-section">
        <h3 class="form-section-title">Personal Information</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="first_name">First Name</label>
            <input type="text" id="first_name" name="first_name" value="<%= firstName %>" required />
          </div>
          <div class="form-group">
            <label for="last_name">Last Name</label>
            <input type="text" id="last_name" name="last_name" value="<%= lastName %>" required />
          </div>
        </div>
        
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" name="email" value="<%= email %>" required />
          <span class="form-hint">This is also your login email</span>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" value="<%= phone %>" placeholder="(801) 555-1234" />
          </div>
          <div class="form-group">
            <label for="birthdate">Date of Birth</label>
            <input type="date" id="birthdate" name="birthdate" value="<%= birthdate %>" />
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="form-section-title">Education</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="school">School</label>
            <input type="text" id="school" name="school" value="<%= school %>" placeholder="Your school name" />
          </div>
          <div class="form-group">
            <label for="grade">Grade</label>
            <select id="grade" name="grade">
              <option value="">Select grade...</option>
              <option value="6" <%= grade === '6' ? 'selected' : '' %>>6th Grade</option>
              <option value="7" <%= grade === '7' ? 'selected' : '' %>>7th Grade</option>
              <option value="8" <%= grade === '8' ? 'selected' : '' %>>8th Grade</option>
              <option value="9" <%= grade === '9' ? 'selected' : '' %>>9th Grade (Freshman)</option>
              <option value="10" <%= grade === '10' ? 'selected' : '' %>>10th Grade (Sophomore)</option>
              <option value="11" <%= grade === '11' ? 'selected' : '' %>>11th Grade (Junior)</option>
              <option value="12" <%= grade === '12' ? 'selected' : '' %>>12th Grade (Senior)</option>
              <option value="college" <%= grade === 'college' ? 'selected' : '' %>>College</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </div>
    </form>
  </div>
  
  <!-- Security Tab -->
  <div class="tab-panel" id="tab-security">
    <form action="/my-journey/account" method="POST" class="profile-form">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <input type="hidden" name="action" value="change_password" />
      
      <div class="form-section">
        <h3 class="form-section-title">Change Password</h3>
        
        <div class="form-group">
          <label for="current_password">Current Password</label>
          <input type="password" id="current_password" name="current_password" required />
        </div>
        
        <div class="form-group">
          <label for="new_password">New Password</label>
          <input type="password" id="new_password" name="new_password" required minlength="8" />
          <span class="form-hint">Minimum 8 characters</span>
        </div>
        
        <div class="form-group">
          <label for="confirm_password">Confirm New Password</label>
          <input type="password" id="confirm_password" name="confirm_password" required />
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Update Password</button>
      </div>
    </form>
    
    <div class="form-section mt-4">
      <h3 class="form-section-title">Account Actions</h3>
      <p class="text-muted">If you need to delete your account, please contact us at <a href="mailto:nadia@ellarises.org">nadia@ellarises.org</a>.</p>
    </div>
  </div>
  
  <!-- Preferences Tab -->
  <div class="tab-panel" id="tab-preferences">
    <form action="/my-journey/account" method="POST" class="profile-form">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <input type="hidden" name="action" value="update_preferences" />
      
      <div class="form-section">
        <h3 class="form-section-title">Communication Preferences</h3>
        
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" name="email_events" value="1" checked />
            <span class="checkbox-custom"></span>
            <span class="checkbox-text">
              <strong>Event Updates</strong>
              <span>Receive emails about new events and registration reminders</span>
            </span>
          </label>
        </div>
        
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" name="email_surveys" value="1" checked />
            <span class="checkbox-custom"></span>
            <span class="checkbox-text">
              <strong>Survey Notifications</strong>
              <span>Get notified when surveys are available after events</span>
            </span>
          </label>
        </div>
        
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" name="email_milestones" value="1" checked />
            <span class="checkbox-custom"></span>
            <span class="checkbox-text">
              <strong>Milestone Reminders</strong>
              <span>Receive reminders about your milestone progress</span>
            </span>
          </label>
        </div>
        
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" name="email_newsletter" value="1" checked />
            <span class="checkbox-custom"></span>
            <span class="checkbox-text">
              <strong>Newsletter</strong>
              <span>Receive our monthly newsletter with updates and stories</span>
            </span>
          </label>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Save Preferences</button>
      </div>
    </form>
  </div>
</div>

<!-- Photo Upload Modal -->
<div id="photoUploadModal" class="modal">
  <div class="modal-overlay" onclick="closePhotoUpload()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>Upload Profile Photo</h3>
      <button class="modal-close" onclick="closePhotoUpload()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <form action="/my-journey/account/photo" method="POST" enctype="multipart/form-data" class="modal-body">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <input type="hidden" name="photo_type" value="profile" />
      
      <div class="upload-area" id="profileUploadArea">
        <div class="upload-placeholder">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
          <p>Click or drag to upload a photo</p>
          <span class="text-muted">JPG, PNG up to 5MB</span>
        </div>
        <input type="file" name="photo" id="profilePhotoInput" accept="image/*" required />
      </div>
      
      <div class="upload-preview" id="profilePreview" style="display: none;">
        <img src="" alt="Preview" />
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-ghost" onclick="closePhotoUpload()">Cancel</button>
        <button type="submit" class="btn btn-primary">Upload Photo</button>
      </div>
    </form>
  </div>
</div>

<!-- Cover Photo Upload Modal -->
<div id="coverUploadModal" class="modal">
  <div class="modal-overlay" onclick="closeCoverUpload()"></div>
  <div class="modal-content modal-content--wide">
    <div class="modal-header">
      <h3>Upload Cover Photo</h3>
      <button class="modal-close" onclick="closeCoverUpload()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <form action="/my-journey/account/photo" method="POST" enctype="multipart/form-data" class="modal-body">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <input type="hidden" name="photo_type" value="cover" />
      
      <div class="upload-area upload-area--wide" id="coverUploadArea">
        <div class="upload-placeholder">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
          <p>Click or drag to upload a cover photo</p>
          <span class="text-muted">Recommended: 1200x400px, JPG or PNG</span>
        </div>
        <input type="file" name="photo" id="coverPhotoInput" accept="image/*" required />
      </div>
      
      <div class="upload-preview upload-preview--wide" id="coverPreview" style="display: none;">
        <img src="" alt="Preview" />
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-ghost" onclick="closeCoverUpload()">Cancel</button>
        <button type="submit" class="btn btn-primary">Upload Cover</button>
      </div>
    </form>
  </div>
</div>

<style>
  /* Profile Header */
  .profile-header {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-soft);
    margin-bottom: 1.5rem;
  }
  
  .profile-cover {
    position: relative;
    height: 200px;
    background: linear-gradient(135deg, var(--color-primary-soft) 0%, var(--color-lavender) 50%, var(--color-dusty-blue) 100%);
  }
  
  .cover-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .cover-placeholder {
    width: 100%;
    height: 100%;
  }
  
  .cover-edit-btn {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: var(--radius-pill);
    font-size: var(--text-sm);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
    box-shadow: var(--shadow-soft);
  }
  
  .cover-edit-btn:hover {
    background: #fff;
    box-shadow: var(--shadow-medium);
  }
  
  .profile-header-content {
    display: flex;
    align-items: flex-end;
    gap: 1.5rem;
    padding: 0 2rem 1.5rem;
    margin-top: -50px;
    position: relative;
  }
  
  .profile-avatar-container {
    position: relative;
    flex-shrink: 0;
  }
  
  .profile-avatar {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: var(--color-surface);
    border: 4px solid var(--color-surface);
    box-shadow: var(--shadow-medium);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .profile-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .profile-avatar .initials {
    font-family: var(--font-heading);
    font-size: var(--text-4xl);
    color: var(--color-primary-dark);
    background: var(--color-primary-soft);
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .avatar-edit-btn {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--color-primary-dark);
    color: #fff;
    border: 3px solid var(--color-surface);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .avatar-edit-btn:hover {
    background: var(--color-accent-dark);
    transform: scale(1.1);
  }
  
  .profile-header-info {
    flex: 1;
    padding-bottom: 0.5rem;
  }
  
  .profile-name {
    font-size: var(--text-2xl);
    margin: 0 0 0.25rem;
  }
  
  .profile-email {
    color: var(--color-text-muted);
    margin: 0 0 0.75rem;
  }
  
  .profile-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .profile-header-actions {
    flex-shrink: 0;
    padding-bottom: 0.5rem;
  }
  
  /* Profile Tabs */
  .profile-tabs {
    display: flex;
    gap: 0.5rem;
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: 0.5rem;
    box-shadow: var(--shadow-soft);
    margin-bottom: 1.5rem;
  }
  
  .profile-tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border: none;
    background: transparent;
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text-muted);
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .profile-tab:hover {
    background: var(--color-bg);
    color: var(--color-text);
  }
  
  .profile-tab--active {
    background: var(--color-primary-soft);
    color: var(--color-primary-dark);
  }
  
  /* Tab Panels */
  .tab-panel {
    display: none;
  }
  
  .tab-panel--active {
    display: block;
    animation: fadeIn 0.3s ease-out;
  }
  
  /* Profile Form */
  .profile-form {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow-soft);
  }
  
  .form-section {
    margin-bottom: 2rem;
  }
  
  .form-section:last-child {
    margin-bottom: 0;
  }
  
  .form-section-title {
    font-size: var(--text-lg);
    margin: 0 0 1.25rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--color-border-subtle);
  }
  
  .form-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
  
  .form-hint {
    display: block;
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    margin-top: 0.35rem;
  }
  
  .form-actions {
    padding-top: 1.5rem;
    border-top: 1px solid var(--color-border-subtle);
    margin-top: 1.5rem;
    display: flex;
    justify-content: flex-end;
  }
  
  /* Checkbox Group */
  .checkbox-group {
    margin-bottom: 1rem;
  }
  
  .checkbox-label {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    cursor: pointer;
    padding: 1rem;
    background: var(--color-bg);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
  }
  
  .checkbox-label:hover {
    background: var(--color-primary-soft);
  }
  
  .checkbox-label input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }
  
  .checkbox-custom {
    width: 20px;
    height: 20px;
    border: 2px solid var(--color-border-strong);
    border-radius: var(--radius-sm);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-fast);
    margin-top: 2px;
  }
  
  .checkbox-label input:checked + .checkbox-custom {
    background: var(--color-primary-dark);
    border-color: var(--color-primary-dark);
  }
  
  .checkbox-label input:checked + .checkbox-custom::after {
    content: '';
    width: 6px;
    height: 10px;
    border: solid #fff;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
    margin-bottom: 2px;
  }
  
  .checkbox-text {
    display: flex;
    flex-direction: column;
  }
  
  .checkbox-text strong {
    font-size: var(--text-sm);
    margin-bottom: 0.15rem;
  }
  
  .checkbox-text span {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }
  
  /* Upload Area */
  .upload-area {
    position: relative;
    border: 2px dashed var(--color-border-strong);
    border-radius: var(--radius-lg);
    padding: 3rem 2rem;
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .upload-area:hover {
    border-color: var(--color-primary);
    background: var(--color-primary-soft);
  }
  
  .upload-area input {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
  }
  
  .upload-placeholder {
    pointer-events: none;
  }
  
  .upload-placeholder svg {
    color: var(--color-text-light);
    margin-bottom: 1rem;
  }
  
  .upload-placeholder p {
    margin: 0 0 0.25rem;
    font-weight: 500;
  }
  
  .upload-area--wide {
    padding: 2rem;
  }
  
  .upload-preview {
    margin-top: 1rem;
    border-radius: var(--radius-md);
    overflow: hidden;
  }
  
  .upload-preview img {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border-radius: 50%;
    margin: 0 auto;
    display: block;
  }
  
  .upload-preview--wide img {
    width: 100%;
    height: 150px;
    border-radius: var(--radius-md);
  }
  
  .modal-content--wide {
    max-width: 600px;
  }
  
  /* Modal Styles */
  .modal {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    visibility: hidden;
    opacity: 0;
    transition: all var(--transition-base);
  }
  
  .modal.open {
    visibility: visible;
    opacity: 1;
  }
  
  .modal-overlay {
    position: absolute;
    inset: 0;
    background: rgba(58, 63, 59, 0.5);
    backdrop-filter: blur(4px);
  }
  
  .modal-content {
    position: relative;
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-large);
    transform: translateY(20px);
    transition: transform var(--transition-base);
  }
  
  .modal.open .modal-content {
    transform: translateY(0);
  }
  
  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--color-border-subtle);
  }
  
  .modal-header h3 {
    margin: 0;
    font-size: var(--text-lg);
  }
  
  .modal-close {
    width: 32px;
    height: 32px;
    border: none;
    background: transparent;
    cursor: pointer;
    color: var(--color-text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
  }
  
  .modal-close:hover {
    background: var(--color-bg);
    color: var(--color-text);
  }
  
  .modal-body {
    padding: 1.5rem;
  }
  
  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
    padding-top: 1rem;
    border-top: 1px solid var(--color-border-subtle);
    margin-top: 1rem;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .profile-header-content {
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 0 1rem 1.5rem;
    }
    
    .profile-avatar {
      width: 120px;
      height: 120px;
    }
    
    .profile-header-info {
      width: 100%;
    }
    
    .profile-badges {
      justify-content: center;
    }
    
    .profile-tabs {
      flex-wrap: wrap;
    }
    
    .profile-tab {
      flex: 1;
      justify-content: center;
      min-width: 100px;
    }
    
    .form-row {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  // Tab switching
  document.querySelectorAll('.profile-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      const targetTab = tab.dataset.tab;
      
      // Update active tab
      document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('profile-tab--active'));
      tab.classList.add('profile-tab--active');
      
      // Update content
      document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.classList.remove('tab-panel--active');
      });
      document.getElementById('tab-' + targetTab).classList.add('tab-panel--active');
    });
  });
  
  // Photo upload modals
  function openPhotoUpload() {
    document.getElementById('photoUploadModal').classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  
  function closePhotoUpload() {
    document.getElementById('photoUploadModal').classList.remove('open');
    document.body.style.overflow = '';
  }
  
  function openCoverUpload() {
    document.getElementById('coverUploadModal').classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  
  function closeCoverUpload() {
    document.getElementById('coverUploadModal').classList.remove('open');
    document.body.style.overflow = '';
  }
  
  // File preview
  document.getElementById('profilePhotoInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('profilePreview').style.display = 'block';
        document.getElementById('profilePreview').querySelector('img').src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });
  
  document.getElementById('coverPhotoInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('coverPreview').style.display = 'block';
        document.getElementById('coverPreview').querySelector('img').src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });
  
  // Close modals on escape
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closePhotoUpload();
      closeCoverUpload();
    }
  });
</script>
