<!-- views/myJourney/surveys.ejs -->

<section class="section">
  <div class="shell">
    <aside class="sidebar">
      <%- include("../partials/_sidebarMyJourney") %>
    </aside>

    <section>
      <header class="mb-3">
        <h1 class="mt-0">My Surveys</h1>
        <p class="text-muted">
          Share your experience after events. Your feedback helps Ella Rises
          improve programs and celebrate what is working best.
        </p>
      </header>

      <div class="grid" style="grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.1fr); gap: 2rem;">
        <!-- Pending surveys -->
        <section>
          <div class="card">
            <div class="flex-between" style="gap: 1rem; align-items: center;">
              <div>
                <h2 class="mt-0">Surveys to complete</h2>
                <p class="text-muted">
                  These are the events where we would love to hear from you.
                </p>
              </div>
            </div>

            <% if (!pendingSurveys || pendingSurveys.length === 0) { %>
              <div class="alert alert-success mt-2">
                âœ¨ You are all caught up. Thank you for sharing your voice.
              </div>
            <% } else { %>
              <table class="table mt-2">
                <thead>
                  <tr>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Location</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <% pendingSurveys.forEach(s => { %>
                    <tr>
                      <td><strong><%= s.event_name %></strong></td>
                      <td><%= s.event_date_start_formatted %></td>
                      <td><%= s.event_location %></td>
                      <td>
                        <a href="/my-journey/surveys/<%= s.registration_id %>" class="btn btn-primary btn-sm">
                          Complete
                        </a>
                      </td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            <% } %>
          </div>
        </section>

        <!-- Completed surveys -->
        <section>
          <div class="card">
            <h2 class="mt-0">Survey history</h2>
            <p class="text-muted">
              A record of surveys you have already submitted.
            </p>

            <% if (!completedSurveys || completedSurveys.length === 0) { %>
              <p class="text-muted mt-2">
                Once you submit surveys, they will appear here with summary scores.
              </p>
            <% } else { %>
              <table class="table mt-2">
                <thead>
                  <tr>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Overall score</th>
                    <th>Submitted</th>
                  </tr>
                </thead>
                <tbody>
                  <% completedSurveys.forEach(s => { %>
                    <tr>
                      <td><%= s.event_name %></td>
                      <td><%= s.event_date_start_formatted %></td>
                      <td>
                        <% if (s.survey_overall_score) { %>
                          <span class="badge badge--accent">
                            <%= s.survey_overall_score %>
                          </span>
                        <% } else { %>
                          <span class="text-muted" style="font-size: var(--text-xs);">
                            n/a
                          </span>
                        <% } %>
                      </td>
                      <td><%= s.survey_submission_date_formatted || '' %></td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            <% } %>
          </div>
        </section>
      </div>
    </section>
  </div>
</section>
